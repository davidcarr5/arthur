<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sales Ramp</title>

    <!-- Tailwind (optional) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React + ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>

  <body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useMemo } = React;

      function SalesRampCalendar() {
        const [startDate, setStartDate] = useState("2025-03-01");
        const [currentWeek, setCurrentWeek] = useState(1);
        const [activeTab, setActiveTab] = useState("calendar");

        // What-if scenario inputs
        const [scenarioCalls, setScenarioCalls] = useState(180);
        const [scenarioEnrollments, setScenarioEnrollments] = useState(40);
        const [scenarioCloseRate, setScenarioCloseRate] = useState(20);
        const [scenarioHours, setScenarioHours] = useState(6);

        // Constants
        const TRAINING_WEEKS = 6;
        const ENROLLMENT_TO_MEETING_WEEKS = 1.5;
        const MEETING_TO_CLOSE_WEEKS = 6;
        const AVG_DEAL_VALUE = 15600;
        const BASE_CLOSE_RATE = 0.2;

        const milestones = [
          { month: 3, week: 13, target: 0, description: "First closes expected", type: "info" },
          { month: 4, week: 17, target: 31200, description: "2 deals/month rhythm", type: "warning" },
          { month: 6, week: 26, target: 46800, description: "Foundation complete - 3 deals/month", type: "success" },
          { month: 9, week: 39, target: 75000, description: "Tier 1 Target - $25k/mo avg", type: "milestone" },
          { month: 12, week: 52, target: 93600, description: "Maintain Tier 1 + repeat business", type: "success" },
          { month: 18, week: 78, target: 124800, description: "Building to Tier 2", type: "warning" },
          { month: 21, week: 91, target: 150000, description: "Tier 2 Target - $50k/mo avg", type: "milestone" },
        ];

        const parseISO = (iso) => {
          const [y, m, d] = iso.split("-").map(Number);
          return new Date(y, m - 1, d);
        };
        const addDays = (date, days) => {
          const d = new Date(date);
          d.setDate(d.getDate() + days);
          return d;
        };
        const fmt = (date) =>
          date.toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" });

        const getWeekDateRange = (weekNum) => {
          const start = parseISO(startDate);
          const weekStart = addDays(start, (weekNum - 1) * 7);
          const weekEnd = addDays(weekStart, 6);
          return { weekStart, weekEnd };
        };

        const getPhaseForWeek = (weekNum) => {
          if (weekNum <= TRAINING_WEEKS) return "training";
          if (weekNum <= 26) return "foundation";
          if (weekNum <= 52) return "tier1";
          return "tier2";
        };

        const baselineActivityForWeek = (weekNum) => {
          const phase = getPhaseForWeek(weekNum);
          if (phase === "training") {
            const callsPerWeek = weekNum <= 2 ? 40 : weekNum <= 4 ? 80 : 120;
            const enrollmentsPerWeek = weekNum <= 2 ? 10 : weekNum <= 4 ? 20 : 30;
            const prospectingHours = weekNum <= 2 ? 2 : weekNum <= 4 ? 3 : 4;
            return { callsPerWeek, enrollmentsPerWeek, prospectingHours, closeRate: BASE_CLOSE_RATE };
          }
          if (phase === "foundation") {
            return {
              callsPerWeek: 120 + (weekNum - TRAINING_WEEKS) * 3,
              enrollmentsPerWeek: 30 + (weekNum - TRAINING_WEEKS) * 0.5,
              prospectingHours: 4 + (weekNum - TRAINING_WEEKS) * 0.1,
              closeRate: BASE_CLOSE_RATE,
            };
          }
          if (phase === "tier1") return { callsPerWeek: 180, enrollmentsPerWeek: 40, prospectingHours: 6, closeRate: 0.22 };
          return { callsPerWeek: 240, enrollmentsPerWeek: 50, prospectingHours: 8, closeRate: 0.25 };
        };

        const scenarioActivityForWeek = (weekNum) => {
          const baseline = baselineActivityForWeek(weekNum);
          if (weekNum <= TRAINING_WEEKS) return baseline;
          return {
            callsPerWeek: scenarioCalls,
            enrollmentsPerWeek: scenarioEnrollments,
            prospectingHours: scenarioHours,
            closeRate: scenarioCloseRate / 100,
          };
        };

        const getWeekData = (weekNum, useScenario = false) => {
          const phase = getPhaseForWeek(weekNum);
          const activity = useScenario ? scenarioActivityForWeek(weekNum) : baselineActivityForWeek(weekNum);

          const enrollmentWeek = weekNum - Math.ceil(ENROLLMENT_TO_MEETING_WEEKS);
          let meetingsThisWeek = 0;
          if (enrollmentWeek > TRAINING_WEEKS) {
            const pastActivity = useScenario ? scenarioActivityForWeek(enrollmentWeek) : baselineActivityForWeek(enrollmentWeek);
            meetingsThisWeek = pastActivity.enrollmentsPerWeek * 0.04;
          }

          const meetingWeek = weekNum - MEETING_TO_CLOSE_WEEKS;
          let closesThisWeek = 0;
          if (meetingWeek > TRAINING_WEEKS + Math.ceil(ENROLLMENT_TO_MEETING_WEEKS)) {
            const pastEnrollmentWeek = meetingWeek - Math.ceil(ENROLLMENT_TO_MEETING_WEEKS);
            const pastEnrollActivity = useScenario ? scenarioActivityForWeek(pastEnrollmentWeek) : baselineActivityForWeek(pastEnrollmentWeek);
            const pastMeetings = pastEnrollActivity.enrollmentsPerWeek * 0.04;
            closesThisWeek = pastMeetings * activity.closeRate;
          }

          return {
            week: weekNum,
            phase,
            calls: Math.round(activity.callsPerWeek),
            enrollments: Math.round(activity.enrollmentsPerWeek),
            meetings: Math.round(meetingsThisWeek * 10) / 10,
            closes: Math.round(closesThisWeek * 10) / 10,
            revenue: Math.round(closesThisWeek * AVG_DEAL_VALUE),
            prospectingHours: Math.round(activity.prospectingHours * 10) / 10,
            closeRate: Math.round(activity.closeRate * 100),
            dates: getWeekDateRange(weekNum),
          };
        };

        const calculateCumulatives = (throughWeek, useScenario = false) => {
          let totalMeetings = 0, totalCloses = 0, totalRevenue = 0;
          for (let w = 1; w <= throughWeek; w++) {
            const data = getWeekData(w, useScenario);
            totalMeetings += data.meetings;
            totalCloses += data.closes;
            totalRevenue += data.revenue;
          }
          return { totalMeetings, totalCloses, totalRevenue };
        };

        const calculate3MonthAvg = (throughWeek, useScenario = false) => {
          const startWeek = Math.max(1, throughWeek - 12);
          let revenue = 0;
          for (let w = startWeek; w <= throughWeek; w++) revenue += getWeekData(w, useScenario).revenue;
          return Math.round(revenue / 3);
        };

        const weekData = getWeekData(currentWeek);
        const cumulatives = calculateCumulatives(currentWeek);
        const rolling3Mo = calculate3MonthAvg(currentWeek);

        const calendarWeeks = useMemo(() => {
          const weeks = [];
          const startWeek = Math.floor((currentWeek - 1) / 4) * 4 + 1;
          for (let i = 0; i < 4; i++) weeks.push(getWeekData(startWeek + i));
          return weeks;
        }, [currentWeek, startDate]);

        return (
          <div className="w-full max-w-6xl mx-auto p-6">
            <div className="bg-white rounded-xl p-6 shadow">
              <div className="text-2xl font-bold text-slate-800">Sales Ramp-Up</div>
              <div className="text-slate-500 mt-1">
                Week {currentWeek}: {fmt(weekData.dates.weekStart)} – {fmt(weekData.dates.weekEnd)}
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                <div>
                  <label className="block text-sm font-medium text-slate-700 mb-2">Start Date</label>
                  <input
                    type="date"
                    value={startDate}
                    onChange={(e) => setStartDate(e.target.value)}
                    className="w-full px-3 py-2 border border-slate-300 rounded-md"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-slate-700 mb-2">Current Week</label>
                  <input
                    type="range"
                    min="1"
                    max="91"
                    value={currentWeek}
                    onChange={(e) => setCurrentWeek(parseInt(e.target.value))}
                    className="w-full"
                  />
                  <div className="text-xs text-slate-500 mt-1">Week {currentWeek}</div>
                </div>
              </div>

              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                <div className="bg-slate-50 rounded p-3">
                  <div className="text-xs text-slate-600">Calls</div>
                  <div className="text-xl font-bold">{weekData.calls}</div>
                </div>
                <div className="bg-slate-50 rounded p-3">
                  <div className="text-xs text-slate-600">Enrollments</div>
                  <div className="text-xl font-bold">{weekData.enrollments}</div>
                </div>
                <div className="bg-slate-50 rounded p-3">
                  <div className="text-xs text-slate-600">Meetings</div>
                  <div className="text-xl font-bold">{weekData.meetings}</div>
                </div>
                <div className="bg-slate-50 rounded p-3">
                  <div className="text-xs text-slate-600">Revenue</div>
                  <div className="text-xl font-bold">${(weekData.revenue / 1000).toFixed(1)}k</div>
                </div>
              </div>

              <div className="mt-6 text-sm text-slate-600">
                Cumulative revenue: <span className="font-bold text-slate-800">${(cumulatives.totalRevenue / 1000).toFixed(0)}k</span>{" "}
                • Rolling 3-mo avg: <span className="font-bold text-slate-800">${(rolling3Mo / 1000).toFixed(0)}k</span>
              </div>

              <div className="mt-6">
                <div className="font-bold text-slate-800 mb-2">4-week view</div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                  {calendarWeeks.map((w) => (
                    <div key={w.week} className="border rounded-lg p-3 bg-slate-50">
                      <div className="font-semibold">Week {w.week}</div>
                      <div className="text-xs text-slate-500">{fmt(w.dates.weekStart)}</div>
                      <div className="text-xs mt-2">Calls: <span className="font-semibold">{w.calls}</span></div>
                      <div className="text-xs">Enroll: <span className="font-semibold">{w.enrollments}</span></div>
                      <div className="text-xs">Meet: <span className="font-semibold">{w.meetings}</span></div>
                      <div className="text-xs">Rev: <span className="font-semibold">${(w.revenue / 1000).toFixed(1)}k</span></div>
                    </div>
                  ))}
                </div>
              </div>

              <div className="mt-8 text-xs text-slate-400">
                (Single-file version: icons removed because lucide-react requires bundling.)
              </div>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<SalesRampCalendar />);
    </script>
  </body>
</html>
